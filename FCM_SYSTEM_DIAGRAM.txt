# FCM Notification System Architecture

## SYSTEM OVERVIEW

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FuelHub FCM Notification System                      â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Drivers   â”‚          â”‚ Dispatchers  â”‚          â”‚ Gas Station â”‚        â”‚
â”‚  â”‚             â”‚          â”‚              â”‚          â”‚   Users     â”‚        â”‚
â”‚  â”‚ â€¢ Create    â”‚          â”‚ â€¢ Create     â”‚          â”‚ â€¢ Scan QR   â”‚        â”‚
â”‚  â”‚   TX        â”‚          â”‚   TX         â”‚          â”‚ â€¢ Verify    â”‚        â”‚
â”‚  â”‚ â€¢ Receive   â”‚          â”‚ â€¢ Monitor    â”‚          â”‚   TX        â”‚        â”‚
â”‚  â”‚   notif     â”‚          â”‚   TX         â”‚          â”‚ â€¢ Receive   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   notif     â”‚        â”‚
â”‚        â”‚                         â”‚                  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚        â”‚                         â”‚                        â”‚                 â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                          â”‚                                                   â”‚
â”‚                          â–¼                                                   â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚              â”‚    Application Layer    â”‚                                     â”‚
â”‚              â”‚ (Activities/ViewModels) â”‚                                     â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚                           â”‚                                                  â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚        â”‚                  â”‚                  â”‚                              â”‚
â”‚        â–¼                  â–¼                  â–¼                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚   â”‚ Create  â”‚    â”‚  Approve/    â”‚    â”‚  Send Notif    â”‚                    â”‚
â”‚   â”‚ Trans   â”‚    â”‚  Verify      â”‚    â”‚  Use Cases     â”‚                    â”‚
â”‚   â”‚ UseCase â”‚    â”‚  UseCase     â”‚    â”‚                â”‚                    â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚        â”‚                â”‚                  â”‚                               â”‚
â”‚        â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚        â”‚        â”‚                                                          â”‚
â”‚        â–¼        â–¼                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚   â”‚   NotificationRepository Interface     â”‚                              â”‚
â”‚   â”‚                                        â”‚                              â”‚
â”‚   â”‚  â€¢ sendNotification()                  â”‚                              â”‚
â”‚   â”‚  â€¢ sendNotificationToRole()            â”‚                              â”‚
â”‚   â”‚  â€¢ storeUserFcmToken()                 â”‚                              â”‚
â”‚   â”‚  â€¢ getUserFcmToken()                   â”‚                              â”‚
â”‚   â”‚  â€¢ getNotificationHistory()            â”‚                              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚  FirebaseNotificationRepositoryImpl                  â”‚               â”‚
â”‚   â”‚  (Firestore + FCM Integration)                      â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                    â”‚                                                      â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚        â”‚                       â”‚                                          â”‚
â”‚        â–¼                       â–¼                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚   â”‚  Firestore  â”‚       â”‚  FCM Service   â”‚                              â”‚
â”‚   â”‚             â”‚       â”‚  (Firebase)    â”‚                              â”‚
â”‚   â”‚ â€¢ fcm_      â”‚       â”‚                â”‚                              â”‚
â”‚   â”‚   tokens    â”‚       â”‚ â€¢ Routing      â”‚                              â”‚
â”‚   â”‚ â€¢ notif-    â”‚       â”‚ â€¢ Delivery     â”‚                              â”‚
â”‚   â”‚   ications  â”‚       â”‚ â€¢ Queueing     â”‚                              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                  â”‚                                       â”‚
â”‚                                  â–¼                                       â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚   Android Devices        â”‚                          â”‚
â”‚                    â”‚                          â”‚                          â”‚
â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                          â”‚
â”‚                    â”‚  â”‚ FuelHubMessaging   â”‚  â”‚                          â”‚
â”‚                    â”‚  â”‚ Service            â”‚  â”‚                          â”‚
â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                          â”‚
â”‚                    â”‚           â”‚              â”‚                          â”‚
â”‚                    â”‚           â–¼              â”‚                          â”‚
â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                          â”‚
â”‚                    â”‚  â”‚ Notification       â”‚  â”‚                          â”‚
â”‚                    â”‚  â”‚ Center             â”‚  â”‚                          â”‚
â”‚                    â”‚  â”‚ (System UI)        â”‚  â”‚                          â”‚
â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


## FLOW 1: TRANSACTION CREATED NOTIFICATION

USER ACTION:
â””â”€ Driver/Dispatcher creates transaction

BACKEND PROCESSING:
â”œâ”€ CreateFuelTransactionUseCase.execute()
â”‚  â”œâ”€ Validate input
â”‚  â”œâ”€ Check wallet balance
â”‚  â”œâ”€ Save transaction to Firestore
â”‚  â”œâ”€ Deduct fuel from wallet
â”‚  â”œâ”€ Create gas slip
â”‚  â”œâ”€ Audit logging
â”‚  â””â”€ âœ“ Transaction saved
â”‚
â””â”€ SendTransactionCreatedNotificationUseCase.execute()
   â”œâ”€ Query: Get all GAS_STATION role users
   â”œâ”€ For each user:
   â”‚  â”œâ”€ Create notification document in Firestore
   â”‚  â”œâ”€ Retrieve user's FCM token from fcm_tokens collection
   â”‚  â””â”€ Send FCM message via Firebase Messaging Service
   â””â”€ âœ“ Notifications queued

CLOUD PROCESSING (Firebase):
â””â”€ FCM Service processes message queue
   â”œâ”€ Validates tokens
   â”œâ”€ Prioritizes delivery
   â””â”€ Sends to devices

DEVICE RECEPTION:
â””â”€ Gas Station user's Android device
   â”œâ”€ FuelHubMessagingService.onMessageReceived()
   â”œâ”€ Extract notification data
   â”œâ”€ Create notification channel (if Android 8+)
   â”œâ”€ Display system notification
   â””â”€ User sees notification in notification center

USER INTERACTION:
â””â”€ Gas Station user
   â”œâ”€ Sees: "New Transaction: FS-12345678-9999"
   â”œâ”€ Body: Vehicle, liters, driver name
   â”œâ”€ Taps notification
   â””â”€ Navigates to QR code scanner


## FLOW 2: TRANSACTION VERIFIED NOTIFICATION

USER ACTION:
â””â”€ Gas Station user scans transaction QR code

BACKEND PROCESSING:
â”œâ”€ ApproveTransactionUseCase.execute() [or CompleteTransactionUseCase]
â”‚  â”œâ”€ Verify transaction status
â”‚  â”œâ”€ Update status to DISPENSED/VERIFIED
â”‚  â”œâ”€ Audit logging
â”‚  â””â”€ âœ“ Transaction updated
â”‚
â””â”€ SendTransactionVerifiedNotificationUseCase.execute()
   â”œâ”€ Get driver ID from transaction
   â”œâ”€ Create notification document in Firestore
   â”œâ”€ Retrieve driver's FCM token from fcm_tokens collection
   â””â”€ Send FCM message via Firebase Messaging Service

CLOUD PROCESSING (Firebase):
â””â”€ FCM Service processes message queue
   â”œâ”€ Routes to driver's device
   â””â”€ Sends push message

DEVICE RECEPTION:
â””â”€ Driver's Android device
   â”œâ”€ FuelHubMessagingService.onMessageReceived()
   â”œâ”€ Extract verification data
   â”œâ”€ Display confirmation notification
   â””â”€ User sees success notification

USER INTERACTION:
â””â”€ Driver
   â”œâ”€ Sees: "âœ“ Fuel Dispensed: FS-12345678-9999"
   â”œâ”€ Body: Verification details, liters dispensed
   â””â”€ Confirms transaction completion


## DATA MODEL RELATIONSHIPS

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      User Account       â”‚
â”‚                         â”‚
â”‚ id                      â”‚
â”‚ username                â”‚
â”‚ email                   â”‚
â”‚ role (DISPATCHER,       â”‚
â”‚       GAS_STATION, etc)â”‚
â”‚ isActive                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:1
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    FCM Token Record     â”‚
â”‚                         â”‚
â”‚ userId (PK)             â”‚
â”‚ token                   â”‚
â”‚ updatedAt               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Fuel Transaction       â”‚
â”‚                         â”‚
â”‚ id                      â”‚
â”‚ referenceNumber         â”‚
â”‚ driverId                â”‚
â”‚ status: PENDING,        â”‚
â”‚   APPROVED,             â”‚
â”‚   DISPENSED,            â”‚
â”‚   COMPLETED             â”‚
â”‚ litersToPump            â”‚
â”‚ createdAt               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Notification          â”‚
â”‚                         â”‚
â”‚ id (PK)                 â”‚
â”‚ userId (FK)             â”‚
â”‚ transactionId (FK)      â”‚
â”‚ title                   â”‚
â”‚ body                    â”‚
â”‚ notificationType        â”‚
â”‚ sentAt                  â”‚
â”‚ readAt                  â”‚
â”‚ actionedAt              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


## FILE STRUCTURE

FuelHub/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ src/main/
â”‚   â”‚   â”œâ”€â”€ AndroidManifest.xml              â† Added FCM service & permission
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ java/dev/ml/fuelhub/
â”‚   â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ NotificationPayload.kt             [NEW]
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ repository/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Firebase...RepositoryImpl.kt        [MODIFIED]
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ FirebaseNotificationRepositoryImpl  [NEW]
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ NotificationRepository.kt          [NEW]
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ usecase/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ CreateFuelTransactionUseCase.kt    [MODIFIED]
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ SendTransactionCreated...          [NEW]
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ SendTransactionVerified...         [NEW]
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ FuelHubMessagingService.kt             [NEW]
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ di/
â”‚   â”‚   â”‚       â”œâ”€â”€ RepositoryModule.kt                    [MODIFIED]
â”‚   â”‚   â”‚       â””â”€â”€ UseCaseModule.kt                       [MODIFIED]
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ res/
â”‚   â”‚       â”œâ”€â”€ drawable/
â”‚   â”‚       â”‚   â””â”€â”€ ic_launcher_foreground.xml             (for notifications)
â”‚   â”‚       â”‚
â”‚   â”‚       â””â”€â”€ values/
â”‚   â”‚           â””â”€â”€ strings.xml
â”‚   â”‚
â”‚   â””â”€â”€ build.gradle.kts                                  [MODIFIED]
â”‚
â””â”€â”€ Documentation/
    â”œâ”€â”€ FCM_NOTIFICATIONS_SETUP.md           [Complete guide]
    â”œâ”€â”€ FCM_QUICK_START.md                   [Quick reference]
    â”œâ”€â”€ FCM_INTEGRATION_CHECKLIST.md         [Pre-launch]
    â”œâ”€â”€ FCM_AUTH_INTEGRATION_EXAMPLE.kt      [Code examples]
    â”œâ”€â”€ FCM_IMPLEMENTATION_SUMMARY.md        [Architecture]
    â””â”€â”€ FCM_SYSTEM_DIAGRAM.txt               [This file]


## NOTIFICATION CHANNELS (Android 8+)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Notification Channel: CHANNEL_TRANSACTIONâ”‚
â”‚                                         â”‚
â”‚ Name: "Transaction Notifications"       â”‚
â”‚ Importance: IMPORTANCE_HIGH             â”‚
â”‚ Vibration: Enabled                      â”‚
â”‚ Badge: Enabled                          â”‚
â”‚                                         â”‚
â”‚ Usage:                                  â”‚
â”‚ â€¢ Transaction created                   â”‚
â”‚ â€¢ Transaction dispensed                 â”‚
â”‚ â€¢ Transaction verified                  â”‚
â”‚ â€¢ Transaction approved                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Notification Channel: CHANNEL_ALERTS     â”‚
â”‚                                         â”‚
â”‚ Name: "System Alerts"                   â”‚
â”‚ Importance: IMPORTANCE_HIGH             â”‚
â”‚ Vibration: Enabled                      â”‚
â”‚ Badge: Enabled                          â”‚
â”‚                                         â”‚
â”‚ Usage:                                  â”‚
â”‚ â€¢ Wallet low                            â”‚
â”‚ â€¢ System errors                         â”‚
â”‚ â€¢ Important alerts                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


## SECURITY FLOW

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Login                                           â”‚
â”‚                                                      â”‚
â”‚ 1. Email/Password validation (Firebase Auth)         â”‚
â”‚ 2. User document loaded from Firestore               â”‚
â”‚ 3. Role and permissions verified                     â”‚
â”‚ 4. FCM token requested from Google Services          â”‚
â”‚ 5. Token stored in Firestore under user's ID         â”‚
â”‚    (Protected by security rules)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Notification Sending                                 â”‚
â”‚                                                      â”‚
â”‚ 1. Query for target users (role-based)               â”‚
â”‚ 2. For each user, retrieve their FCM token           â”‚
â”‚    (Only if sender is authenticated)                 â”‚
â”‚ 3. Send message via Firebase Cloud Messaging         â”‚
â”‚ 4. Store notification metadata in Firestore          â”‚
â”‚    (Protected by security rules)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Device Receives Notification                         â”‚
â”‚                                                      â”‚
â”‚ 1. FCM delivers to authenticated device              â”‚
â”‚ 2. FuelHubMessagingService receives message          â”‚
â”‚ 3. Validates notification type                       â”‚
â”‚ 4. Creates system notification                       â”‚
â”‚ 5. User interacts with notification                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


## IMPLEMENTATION COMPLETENESS

Status: 95% Complete âœ…

âœ… Core Implementation (Done)
  âœ“ Data models
  âœ“ FCM service
  âœ“ Repositories
  âœ“ Use cases
  âœ“ Dependency injection
  âœ“ Android manifest
  âœ“ Gradle dependencies

âš ï¸ Integration (Remaining)
  â€¢ Runtime permission request (5 minutes)
  â€¢ Token storage on login (5 minutes)
  â€¢ Firestore security rules (2 minutes)

ğŸ§ª Testing (Next Step)
  â€¢ Build project
  â€¢ Test on Android device
  â€¢ Verify notifications appear
  â€¢ Monitor Firestore activity

---

Generated: 2024-12-22
Status: Ready for Integration âœ…
